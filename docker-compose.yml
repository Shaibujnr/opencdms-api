version: "3"

services:
  authdb:
    image: postgres
    container_name: authdb
    hostname: authdb
    ports:
      - "15432:5432"
    environment:
      - POSTGRES_PASSWORD=password
      - POSTGRES_DB=auth

  climsoftdb:
    image: mariadb:10.1
    container_name: climsoftdb
    hostname: climsoftdb
    ports:
      - "13306:3306"
    environment:
      - MYSQL_ROOT_PASSWORD=password
      - MYSQL_DATABASE=climsoft


  surfacedb:
    image: timescale/timescaledb-postgis:latest-pg12
    container_name: surfacedb
    hostname: surfacedb
    ports:
      - "25432:5432"
    environment:
      - POSTGRES_PASSWORD=password
      - POSTGRES_DB=surface


  opencdms-server:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: opencdms-server
    hostname: opencdms-server
    ports:
      - "8000:5000"
    depends_on:
      - authdb
      - climsoftdb
      - surfacedb
    environment:
      - CLIMSOFT_DB_URI=mysql+mysqldb://root:password@climsoftdb/climsoft
      - AUTH_DB_URI=postgresql+psycopg2://postgres:password@authdb/auth
      - SURFACE_DB_URI=postgresql+psycopg2://postgres:password@surfacedb/surface
